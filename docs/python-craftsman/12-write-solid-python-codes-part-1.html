<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Python 工匠：写好面向对象代码的原则（上） | Quarter Life</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="我们，缘起于此">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.a96ff77c.css" as="style"><link rel="preload" href="/assets/js/app.c4198b61.js" as="script"><link rel="preload" href="/assets/js/4.91381aee.js" as="script"><link rel="preload" href="/assets/js/1.2f47c004.js" as="script"><link rel="preload" href="/assets/js/24.2e774eb3.js" as="script"><link rel="prefetch" href="/assets/js/10.11692268.js"><link rel="prefetch" href="/assets/js/11.e45011d2.js"><link rel="prefetch" href="/assets/js/12.21d06a0c.js"><link rel="prefetch" href="/assets/js/13.66d9d9d0.js"><link rel="prefetch" href="/assets/js/14.0ca55d6c.js"><link rel="prefetch" href="/assets/js/15.e14904ca.js"><link rel="prefetch" href="/assets/js/16.8c0b5638.js"><link rel="prefetch" href="/assets/js/17.47fc2f6f.js"><link rel="prefetch" href="/assets/js/18.eb85cfcc.js"><link rel="prefetch" href="/assets/js/19.4e5e9ea0.js"><link rel="prefetch" href="/assets/js/2.5cfdb97c.js"><link rel="prefetch" href="/assets/js/20.9436f086.js"><link rel="prefetch" href="/assets/js/21.09ca3521.js"><link rel="prefetch" href="/assets/js/22.d3fbf1d1.js"><link rel="prefetch" href="/assets/js/23.9054cf7b.js"><link rel="prefetch" href="/assets/js/25.ec6f66b5.js"><link rel="prefetch" href="/assets/js/26.1d5c177a.js"><link rel="prefetch" href="/assets/js/27.4573d49f.js"><link rel="prefetch" href="/assets/js/28.55365cd8.js"><link rel="prefetch" href="/assets/js/29.00058c92.js"><link rel="prefetch" href="/assets/js/30.080716ba.js"><link rel="prefetch" href="/assets/js/31.9dd23ebb.js"><link rel="prefetch" href="/assets/js/32.5a2fb816.js"><link rel="prefetch" href="/assets/js/33.56779805.js"><link rel="prefetch" href="/assets/js/34.55a4027f.js"><link rel="prefetch" href="/assets/js/35.5e5cf3ea.js"><link rel="prefetch" href="/assets/js/36.92c4d5a0.js"><link rel="prefetch" href="/assets/js/37.6aa8c3d7.js"><link rel="prefetch" href="/assets/js/38.28e8ff50.js"><link rel="prefetch" href="/assets/js/5.fd3aeff0.js"><link rel="prefetch" href="/assets/js/6.b2b7f3c0.js"><link rel="prefetch" href="/assets/js/7.0fdf8a43.js"><link rel="prefetch" href="/assets/js/8.c2f52474.js"><link rel="prefetch" href="/assets/js/9.1a7d8bd6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a96ff77c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-272a5bff><div data-v-272a5bff><div id="loader-wrapper" class="loading-wrapper" data-v-2c578df8 data-v-272a5bff data-v-272a5bff><div class="loader-main" data-v-2c578df8><div data-v-2c578df8></div><div data-v-2c578df8></div><div data-v-2c578df8></div><div data-v-2c578df8></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-7c2f76d1 data-v-272a5bff data-v-272a5bff><h3 class="title" data-v-7c2f76d1 data-v-7c2f76d1>Quarter Life</h3> <p class="description" data-v-7c2f76d1 data-v-7c2f76d1>我们，缘起于此</p> <label id="box" class="inputBox" data-v-7c2f76d1 data-v-7c2f76d1><input type="password" value="" data-v-7c2f76d1> <span data-v-7c2f76d1>Konck! Knock!</span> <button data-v-7c2f76d1>OK</button></label> <div class="footer" data-v-7c2f76d1 data-v-7c2f76d1><span data-v-7c2f76d1><i class="iconfont reco-theme" data-v-7c2f76d1></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-7c2f76d1>vuePress-theme-reco</a></span> <span data-v-7c2f76d1><i class="iconfont reco-copyright" data-v-7c2f76d1></i> <a data-v-7c2f76d1><span data-v-7c2f76d1>Elio</span>
            
          <span data-v-7c2f76d1>2019 - </span>
          2021
        </a></span></div></div> <div class="hide" data-v-272a5bff><header class="navbar" data-v-272a5bff><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Quarter Life" class="logo"> <span class="site-name">Quarter Life</span></a> <div class="links"><div id="dayNightSwitch" class="generalWrapper" data-v-23742090><a class="click" data-v-23742090><div class="onOff daySwitch" data-v-23742090><div class="star star1" data-v-23742090></div> <div class="star star2" data-v-23742090></div> <div class="star star3" data-v-23742090></div> <div class="star star4" data-v-23742090></div> <div class="star star5" data-v-23742090></div> <div class="star sky" data-v-23742090></div> <div class="sunMoon" data-v-23742090><div class="crater crater1" data-v-23742090></div> <div class="crater crater2" data-v-23742090></div> <div class="crater crater3" data-v-23742090></div> <div class="cloud part1" data-v-23742090></div> <div class="cloud part2" data-v-23742090></div></div></div></a></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/关于我/" class="nav-link"><i class="undefined"></i>
  关于我
</a></li><li class="dropdown-item"><!----> <a href="/categories/辅助记录文档/" class="nav-link"><i class="undefined"></i>
  辅助记录文档
</a></li><li class="dropdown-item"><!----> <a href="/categories/编程规范文档/" class="nav-link"><i class="undefined"></i>
  编程规范文档
</a></li><li class="dropdown-item"><!----> <a href="/categories/书籍/" class="nav-link"><i class="undefined"></i>
  书籍
</a></li><li class="dropdown-item"><!----> <a href="/categories/软件安装部署/" class="nav-link"><i class="undefined"></i>
  软件安装部署
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/python-craftsman/" class="nav-link router-link-active"><i class="undefined"></i>
  python-craftsman
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/quarter-life" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-272a5bff></div> <aside class="sidebar" data-v-272a5bff><div class="personal-info-wrapper" data-v-25b2bb28 data-v-272a5bff><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-25b2bb28> <h3 class="name" data-v-25b2bb28>
    Elio
  </h3> <div class="num" data-v-25b2bb28><div data-v-25b2bb28><h3 data-v-25b2bb28>26</h3> <h6 data-v-25b2bb28>Articles</h6></div> <div data-v-25b2bb28><h3 data-v-25b2bb28>6</h3> <h6 data-v-25b2bb28>Tags</h6></div></div> <ul class="social-links" data-v-25b2bb28></ul> <hr data-v-25b2bb28></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/关于我/" class="nav-link"><i class="undefined"></i>
  关于我
</a></li><li class="dropdown-item"><!----> <a href="/categories/辅助记录文档/" class="nav-link"><i class="undefined"></i>
  辅助记录文档
</a></li><li class="dropdown-item"><!----> <a href="/categories/编程规范文档/" class="nav-link"><i class="undefined"></i>
  编程规范文档
</a></li><li class="dropdown-item"><!----> <a href="/categories/书籍/" class="nav-link"><i class="undefined"></i>
  书籍
</a></li><li class="dropdown-item"><!----> <a href="/categories/软件安装部署/" class="nav-link"><i class="undefined"></i>
  软件安装部署
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/python-craftsman/" class="nav-link router-link-active"><i class="undefined"></i>
  python-craftsman
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/quarter-life" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><a href="/docs/python-craftsman/" aria-current="page" class="sidebar-link">Python工匠-笔记</a></li><li><a href="/docs/python-craftsman/1-using-variables-well.html" class="sidebar-link">Python 工匠：善用变量来改善代码质量</a></li><li><a href="/docs/python-craftsman/2-if-else-block-secrets.html" class="sidebar-link">Python 工匠：编写条件分支代码的技巧</a></li><li><a href="/docs/python-craftsman/3-tips-on-numbers-and-strings.html" class="sidebar-link">Python 工匠：使用数字与字符串的技巧</a></li><li><a href="/docs/python-craftsman/7-two-tips-on-loop-writing.html" class="sidebar-link">Python 工匠：编写地道循环的两个建议</a></li><li><a href="/docs/python-craftsman/4-mastering-container-types.html" class="sidebar-link">Python 工匠：容器的门道</a></li><li><a href="/docs/python-craftsman/6-three-rituals-of-exceptions-handling.html" class="sidebar-link">Python 工匠： 异常处理的三个好习惯</a></li><li><a href="/docs/python-craftsman/5-function-returning-tips.html" class="sidebar-link">Python 工匠：让函数返回结果的技巧</a></li><li><a href="/docs/python-craftsman/8-tips-on-decorators.html" class="sidebar-link">Python 工匠：使用装饰器的技巧</a></li><li><a href="/docs/python-craftsman/9-a-story-on-cyclic-imports.html" class="sidebar-link">Python 工匠：一个关于模块的小故事</a></li><li><a href="/docs/python-craftsman/10-a-good-player-know-the-rules.html" class="sidebar-link">Python 工匠：做一个精通规则的玩家</a></li><li><a href="/docs/python-craftsman/11-three-tips-on-writing-file-related-codes.html" class="sidebar-link">Python 工匠：高效操作文件的三个建议</a></li><li><a href="/docs/python-craftsman/12-write-solid-python-codes-part-1.html" aria-current="page" class="active sidebar-link">Python 工匠：写好面向对象代码的原则（上）</a></li><li><a href="/docs/python-craftsman/13-write-solid-python-codes-part-2.html" class="sidebar-link">Python 工匠：写好面向对象代码的原则（中）</a></li><li><a href="/docs/python-craftsman/14-write-solid-python-codes-part-3.html" class="sidebar-link">Python 工匠：写好面向对象代码的原则（下）</a></li><li><a href="/docs/python-craftsman/15-thinking-in-edge-cases.html" class="sidebar-link">Python 工匠：在边界处思考</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-7c2f76d1 data-v-272a5bff><h3 class="title" data-v-7c2f76d1 data-v-7c2f76d1>Python 工匠：写好面向对象代码的原则（上）</h3> <!----> <label id="box" class="inputBox" data-v-7c2f76d1 data-v-7c2f76d1><input type="password" value="" data-v-7c2f76d1> <span data-v-7c2f76d1>Konck! Knock!</span> <button data-v-7c2f76d1>OK</button></label> <div class="footer" data-v-7c2f76d1 data-v-7c2f76d1><span data-v-7c2f76d1><i class="iconfont reco-theme" data-v-7c2f76d1></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-7c2f76d1>vuePress-theme-reco</a></span> <span data-v-7c2f76d1><i class="iconfont reco-copyright" data-v-7c2f76d1></i> <a data-v-7c2f76d1><span data-v-7c2f76d1>Elio</span>
            
          <span data-v-7c2f76d1>2019 - </span>
          2021
        </a></span></div></div> <div data-v-272a5bff><main class="page" style="padding-right:0;"><section><div class="page-title"><h1 class="title">Python 工匠：写好面向对象代码的原则（上）</h1> <div data-v-cf73456e><i class="iconfont reco-account" data-v-cf73456e><span data-v-cf73456e>Piglei</span></i> <i class="iconfont reco-date" data-v-cf73456e><span data-v-cf73456e>8/23/2021</span></i> <i class="iconfont reco-eye" data-v-cf73456e><span id="/docs/python-craftsman/12-write-solid-python-codes-part-1.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-cf73456e><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-cf73456e><span class="tag-item" data-v-cf73456e>Python</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <blockquote><p>这是 “Python 工匠”系列的第 12 篇文章。<a href="https://github.com/piglei/one-python-craftsman" target="_blank" rel="noopener noreferrer">[查看系列所有文章]<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>Python 是一门支持多种编程风格的语言，面对相同的需求，拥有不同背景的程序员可能会写出风格迥异的 Python 代码。比如一位习惯编写 C 语言的程序员，通常会定义一大堆函数来搞定所有事情，这是<a href="https://en.wikipedia.org/wiki/Procedural_programming" target="_blank" rel="noopener noreferrer">“过程式编程”<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的思想。而一位有 Java 背景的程序员则更倾向于设计许多个相互关联的类*（class）*，这是 <a href="https://en.wikipedia.org/wiki/Object-oriented_programming" target="_blank" rel="noopener noreferrer">“面向对象编程（后简称 OOP）”<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>虽然不同的编程风格各有特点，无法直接比较。但是 OOP 思想在现代软件开发中起到的重要作用应该是毋庸置疑的。</p> <p>很多人在学习如何写好 OOP 代码时，会选择从那 <a href="https://zh.wikipedia.org/wiki/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F_(%E8%AE%A1%E7%AE%97%E6%9C%BA)" target="_blank" rel="noopener noreferrer">23 种经典的“设计模式”<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>开始。不过对于 Python 程序员来说，我认为这并非是一个最佳选择。</p> <h3 id="python-对-oop-的支持"><a href="#python-对-oop-的支持" class="header-anchor">#</a> Python 对 OOP 的支持</h3> <p>Python 语言虽然拥有类、继承、多态等核心 OOP 特性，但和那些完全基于 OOP 思想设计的编程语言*（比如 Java）*相比，它在 OOP 支持方面做了很多简化工作。比如它 <strong>没有严格的类私有成员，没有接口（Interface）对象</strong> 等。</p> <p>而与此同时，Python 灵活的函数对象、鸭子类型等许多动态特性又让一些在其他语言中很难做到的事情变得非常简单。这些语言间的差异共同导致了一个结果：<em>很多经典的设计模式到了 Python 里，就丢失了那个“味道”，实用性也大打折扣。</em></p> <p>拿大家最熟悉的单例模式来说。你可以花上一大把时间，来学习如何在 Python 中利用 <code>__new__</code> 方法或元类*（metaclass）*来实现单例设计模式，但最后你会发现，自己 95% 的需求都可以通过直接定义一个模块级全局变量来搞定。</p> <p>所以，与具体化的 <strong>设计模式</strong> 相比，我觉得一些更为抽象的 <strong>设计原则</strong> 适用性更广、更适合运用到 Python 开发工作中。而谈到关于 OOP 的设计原则，“SOLID” 是众多原则中最有名的一个。</p> <h3 id="solid-设计原则"><a href="#solid-设计原则" class="header-anchor">#</a> SOLID 设计原则</h3> <p>著名的设计模式书籍<a href="https://book.douban.com/subject/1052241/" target="_blank" rel="noopener noreferrer">《设计模式：可复用面向对象软件的基础》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>出版于 1994 年，距今已有超过 25 年的历史。而这篇文章的主角： “SOLID 设计原则”同样也并不年轻。</p> <p>早在 2000 年，<a href="https://en.wikipedia.org/wiki/Robert_C._Martin" target="_blank" rel="noopener noreferrer">Robert C. Martin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 就在他的文章 &quot;Design Principles and Design Patterns&quot; 中整理并提出了 “SOLID” 设计原则的雏型，之后又在他的经典著作<a href="https://book.douban.com/subject/1140457/" target="_blank" rel="noopener noreferrer">《敏捷软件开发 : 原则、模式与实践》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中将其发扬光大。“SOLID” 由 5 个单词组合的首字母缩写组成，分别代表 5 条不同的面向对象领域的设计原则。</p> <p>在编写 OOP 代码时，如果遵循这 5 条设计原则，就更可能写出可扩展、易于修改的代码。相反，如果不断违反其中的一条或多条原则，那么很快你的代码就会变得不可扩展、难以维护。</p> <p>接下来，让我用一个真实的 Python 代码样例来分别向你诠释这 5 条设计原则。</p> <blockquote><p>写在最前面的注意事项：</p> <ol start="0"><li>“原则”不是“法律”，它只起到指导作用，并非不可以违反</li> <li>“原则”的后两条与接口（Interface）有关，而 Python 没有接口，所以对这部分的诠释是我的个人理解，与原版可能略有出入</li> <li>文章后面的内容含有大量代码，请做好心理准备 ☕️</li> <li>为了增强代码的说明性，本文中的代码使用了 Python3 中的 <a href="https://docs.python.org/3/library/typing.html" target="_blank" rel="noopener noreferrer">类型注解特性<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol></blockquote> <h2 id="solid-原则与-python"><a href="#solid-原则与-python" class="header-anchor">#</a> SOLID 原则与 Python</h2> <p><a href="https://news.ycombinator.com/" target="_blank" rel="noopener noreferrer">Hacker News<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><em>(后简称 HN)</em> 是一个在程序员圈子里很受欢迎的站点。在它的首页，有很多由用户提交后基于推荐算法排序的科技相关内容。</p> <p>我经常会去上面看一些热门文章，但我觉得每次打开浏览器访问有点麻烦。所以，我准备编写一个脚本，自动抓取 HN 首页 Top5 的新闻标题与链接，并用纯文本的方式写入到文件。方便自己用其他工具阅读。</p> <div style="text-align:center;color:#999;margin:14px 0 14px;font-size:12px;"><img src="https://www.zlovezl.cn/static/uploaded/2019/06/hackernews_frontpage.png" width="100%">
图：Hacker News 首页截图
</div> <p>编写爬虫几乎是 Python 天生的拿手好戏。利用 requests、lxml 等模块提供的好用功能，我可以轻松实现上面的需求。下面是我第一次编写好的代码：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> io
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> typing <span class="token keyword">import</span> Generator

<span class="token keyword">import</span> requests
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree


<span class="token keyword">class</span> <span class="token class-name">Post</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;HN(https://news.ycombinator.com/) 上的条目

    :param title: 标题
    :param link: 链接
    :param points: 当前得分
    :param comments_cnt: 评论数
    &quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> title<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> link<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> points<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> comments_cnt<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>title <span class="token operator">=</span> title
        self<span class="token punctuation">.</span>link <span class="token operator">=</span> link
        self<span class="token punctuation">.</span>points <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>comments_cnt <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>comments_cnt<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">HNTopPostsSpider</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;抓取 HackerNews Top 内容条目

    :param fp: 存储抓取结果的目标文件对象
    :param limit: 限制条目数，默认为 5
    &quot;&quot;&quot;</span>
    ITEMS_URL <span class="token operator">=</span> <span class="token string">'https://news.ycombinator.com/'</span>
    FILE_TITLE <span class="token operator">=</span> <span class="token string">'Top news on HN'</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> fp<span class="token punctuation">:</span> io<span class="token punctuation">.</span>TextIOBase<span class="token punctuation">,</span> limit<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>fp <span class="token operator">=</span> fp
        self<span class="token punctuation">.</span>limit <span class="token operator">=</span> limit

    <span class="token keyword">def</span> <span class="token function">fetch</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Generator<span class="token punctuation">[</span>Post<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;从 HN 抓取 Top 内容
        &quot;&quot;&quot;</span>
        resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>self<span class="token punctuation">.</span>ITEMS_URL<span class="token punctuation">)</span>

        <span class="token comment"># 使用 XPath 可以方便的从页面解析出你需要的内容，以下均为页面解析代码</span>
        <span class="token comment"># 如果你对 xpath 不熟悉，可以忽略这些代码，直接跳到 yield Post() 部分</span>
        html <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>resp<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        items <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//table[@class=&quot;itemlist&quot;]/tr[@class=&quot;athing&quot;]'</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">[</span><span class="token punctuation">:</span>self<span class="token punctuation">.</span>limit<span class="token punctuation">]</span><span class="token punctuation">:</span>
            node_title <span class="token operator">=</span> item<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./td[@class=&quot;title&quot;]/a'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            node_detail <span class="token operator">=</span> item<span class="token punctuation">.</span>getnext<span class="token punctuation">(</span><span class="token punctuation">)</span>
            points_text <span class="token operator">=</span> node_detail<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'.//span[@class=&quot;score&quot;]/text()'</span><span class="token punctuation">)</span>
            comments_text <span class="token operator">=</span> node_detail<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'.//td/a[last()]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

            <span class="token keyword">yield</span> Post<span class="token punctuation">(</span>
                title<span class="token operator">=</span>node_title<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
                link<span class="token operator">=</span>node_title<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment"># 条目可能会没有评分</span>
                points<span class="token operator">=</span>points_text<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">if</span> points_text <span class="token keyword">else</span> <span class="token string">'0'</span><span class="token punctuation">,</span>
                comments_cnt<span class="token operator">=</span>comments_text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">write_to_file</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;以纯文本格式将 Top 内容写入文件
        &quot;&quot;&quot;</span>
        self<span class="token punctuation">.</span>fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'# </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>FILE_TITLE<span class="token punctuation">}</span></span><span class="token string">\n\n'</span></span><span class="token punctuation">)</span>
        <span class="token comment"># enumerate 接收第二个参数，表示从这个数开始计数（默认为 0）</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> post <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>fetch<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'&gt; TOP </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>post<span class="token punctuation">.</span>title<span class="token punctuation">}</span></span><span class="token string">\n'</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'&gt; 分数：</span><span class="token interpolation"><span class="token punctuation">{</span>post<span class="token punctuation">.</span>points<span class="token punctuation">}</span></span><span class="token string"> 评论数：</span><span class="token interpolation"><span class="token punctuation">{</span>post<span class="token punctuation">.</span>comments_cnt<span class="token punctuation">}</span></span><span class="token string">\n'</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'&gt; 地址：</span><span class="token interpolation"><span class="token punctuation">{</span>post<span class="token punctuation">.</span>link<span class="token punctuation">}</span></span><span class="token string">\n'</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'------\n'</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment"># with open('/tmp/hn_top5.txt') as fp:</span>
    <span class="token comment">#     crawler = HNTopPostsSpider(fp)</span>
    <span class="token comment">#     crawler.write_to_file()</span>

    <span class="token comment"># 因为 HNTopPostsSpider 接收任何 file-like 的对象，所以我们可以把 sys.stdout 传进去</span>
    <span class="token comment"># 实现往控制台标准输出打印的功能</span>
    crawler <span class="token operator">=</span> HNTopPostsSpider<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span>
    crawler<span class="token punctuation">.</span>write_to_file<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br></div></div><p>你可以把上面的代码称之为符合 OOP 风格的，因为在上面的代码里，我定义了两个类：</p> <ol><li><code>Post</code>：表示单个 HN 内容条目，其中定义了标题、链接等字段，是用来衔接“抓取”和“写入文件”两件事情的数据类</li> <li><code>HNTopPostsSpider</code>：抓取 HN 内容的爬虫类，其中定义了抓取页面、解析、写入结果的方法，是完成主要工作的类</li></ol> <p>如果你本地的 Python 环境配置正常，那么可以尝试执行一下上面这段代码，它会输出下面这样的内容：</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>❯ python news_digester.py
&gt; TOP 1: Show HN: NoAgeismInTech – Job board for companies fighting ageism in tech
&gt; 分数：104 评论数：26
&gt; 地址：https://noageismintech.com/
------
&gt; TOP 2: Magic Leap sues former employee who founded the China-based Nreal for IP theft
&gt; 分数：17 评论数：2
&gt; 地址：https://www.bloomberg.com/news/articles/2019-06-18/secretive-magic-leap-says-ex-engineer-copied-headset-for-china
------
... ...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这个脚本基于面向对象的方式编写*（换句话说，就是定义了一些 class 😒）*，可以满足我的需求。但是从设计的角度来看，它却违反了 SOLID 原则的第一条：“Single responsibility principle（单一职责原则）”，让我们来看看是为什么。</p> <h2 id="s-单一职责原则"><a href="#s-单一职责原则" class="header-anchor">#</a> S：单一职责原则</h2> <p>SOLID 设计原则里的第一个字母 S 来自于 “Single responsibility principle（单一职责原则）” 的首字母。这个原则认为：**“一个类应该仅仅只有一个被修改的理由。”**换句话说，每个类都应该只有一种职责。</p> <p>而在上面的代码中，<code>HNTopPostsSpider</code> 这个类违反了这个原则。因为我们可以很容易的找到两个不同的修改它的理由：</p> <ul><li><strong>理由 1</strong>: HN 网站的程序员突然更新了页面样式，旧的 xpath 解析算法从新页面上解析不到内容，需要修改 <code>fetch</code> 方法内的解析逻辑。</li> <li><strong>理由 2</strong>: 用户*（也就是我）*突然觉得纯文本格式的输出不好看，想要改成 Markdown 样式。需要修改 <code>write_to_file</code> 方法内的输出逻辑。</li></ul> <p>所以，<code>HNTopPostsSpider</code> 类违反了“单一职责原则”，因为它有着多个被修改的理由。而这背后的根本原因是因为它承担着 “抓取帖子列表” 和 &quot;将帖子列表写入文件&quot; 这两种完全不同的职责。</p> <h3 id="违反-单一职责原则-的坏处"><a href="#违反-单一职责原则-的坏处" class="header-anchor">#</a> 违反“单一职责原则”的坏处</h3> <p>如果某个类违反了“单一职责原则”，那意味着我们经常会因为不同的原因去修改它。这可能会导致不同功能之间相互影响。比如，可能我在某天调整了页面解析逻辑，却发现输出的文件格式也全部乱掉了。</p> <p>另外，单个类承担的职责越多，意味着这个类的复杂度也就越高，它的维护成本也同样会水涨船高。违反“单一职责原则”的类同样也难以被复用，假如我有其他代码想复用 <code>HNTopPostsSpider</code> 类的抓取和解析逻辑，会发现我必须要提供一个莫名其妙的文件对象给它才行。</p> <p>那么，要如何修改代码才能让它遵循“单一职责原则”呢？办法有很多，最传统的是：<strong>把大类拆分为小类</strong>。</p> <h3 id="拆分大类为多个小类"><a href="#拆分大类为多个小类" class="header-anchor">#</a> 拆分大类为多个小类</h3> <p>为了让 <code>HNTopPostsSpider</code> 类的职责更纯粹，我们可以把其中与“写入文件”相关的内容拆分出去作为一个新的类：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">PostsWriter</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;负责将帖子列表写入到文件
    &quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> fp<span class="token punctuation">:</span> io<span class="token punctuation">.</span>TextIOBase<span class="token punctuation">,</span> title<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>fp <span class="token operator">=</span> fp
        self<span class="token punctuation">.</span>title <span class="token operator">=</span> title

    <span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> posts<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Post<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'# </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>title<span class="token punctuation">}</span></span><span class="token string">\n\n'</span></span><span class="token punctuation">)</span>
        <span class="token comment"># enumerate 接收第二个参数，表示从这个数开始计数（默认为 0）</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> post <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>posts<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'&gt; TOP </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>post<span class="token punctuation">.</span>title<span class="token punctuation">}</span></span><span class="token string">\n'</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'&gt; 分数：</span><span class="token interpolation"><span class="token punctuation">{</span>post<span class="token punctuation">.</span>points<span class="token punctuation">}</span></span><span class="token string"> 评论数：</span><span class="token interpolation"><span class="token punctuation">{</span>post<span class="token punctuation">.</span>comments_cnt<span class="token punctuation">}</span></span><span class="token string">\n'</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'&gt; 地址：</span><span class="token interpolation"><span class="token punctuation">{</span>post<span class="token punctuation">.</span>link<span class="token punctuation">}</span></span><span class="token string">\n'</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'------\n'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>而在 <code>HNTopPostsSpider</code> 类里，可以通过调用 <code>PostsWriter</code> 的方式来完成之前的工作：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">HNTopPostsSpider</span><span class="token punctuation">:</span>
    FILE_TITLE <span class="token operator">=</span> <span class="token string">'Top news on HN'</span>
    
    <span class="token operator">&lt;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 已省略 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">&gt;</span>

    <span class="token keyword">def</span> <span class="token function">write_to_file</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> fp<span class="token punctuation">:</span> io<span class="token punctuation">.</span>TextIOBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;以纯文本格式将 Top 内容写入文件

        实例化参数文件对象 fp 被挪到了 write_to_file 方法中
        &quot;&quot;&quot;</span>
        <span class="token comment"># 将文件写入逻辑托管给 PostsWriter 类处理</span>
        writer <span class="token operator">=</span> PostsWriter<span class="token punctuation">(</span>fp<span class="token punctuation">,</span> title<span class="token operator">=</span>self<span class="token punctuation">.</span>FILE_TITLE<span class="token punctuation">)</span>
        writer<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>fetch<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>通过这种方式，我们让 <code>HNTopPostsSpider</code> 和 <code>PostsWriter</code> 类都各自满足了“单一职责原则”。我只会因为解析逻辑变动才去修改 <code>HNTopPostsSpider</code> 类，同样，修改 <code>PostsWriter</code> 类的原因也只有调整输出格式一种。这两个类各自的修改可以单独进行而不会相互影响。</p> <h3 id="另一种方案-使用函数"><a href="#另一种方案-使用函数" class="header-anchor">#</a> 另一种方案：使用函数</h3> <p>“单一职责原则”虽然是针对类说的，但其实它的适用范围可以超出类本身。比如在 Python 中，通过定义函数，同样也可以让上面的代码符合单一职责原则。</p> <p>我们可以把“写入文件”的逻辑拆分为一个新的函数，由它来专门承担起将帖子列表写入文件的职责：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">write_posts_to_file</span><span class="token punctuation">(</span>posts<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Post<span class="token punctuation">]</span><span class="token punctuation">,</span> fp<span class="token punctuation">:</span> io<span class="token punctuation">.</span>TextIOBase<span class="token punctuation">,</span> title<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;负责将帖子列表写入文件
    &quot;&quot;&quot;</span>
    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'# </span><span class="token interpolation"><span class="token punctuation">{</span>title<span class="token punctuation">}</span></span><span class="token string">\n\n'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> post <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>posts<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'&gt; TOP </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>post<span class="token punctuation">.</span>title<span class="token punctuation">}</span></span><span class="token string">\n'</span></span><span class="token punctuation">)</span>
        fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'&gt; 分数：</span><span class="token interpolation"><span class="token punctuation">{</span>post<span class="token punctuation">.</span>points<span class="token punctuation">}</span></span><span class="token string"> 评论数：</span><span class="token interpolation"><span class="token punctuation">{</span>post<span class="token punctuation">.</span>comments_cnt<span class="token punctuation">}</span></span><span class="token string">\n'</span></span><span class="token punctuation">)</span>
        fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'&gt; 地址：</span><span class="token interpolation"><span class="token punctuation">{</span>post<span class="token punctuation">.</span>link<span class="token punctuation">}</span></span><span class="token string">\n'</span></span><span class="token punctuation">)</span>
        fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'------\n'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>而对于 <code>HNTopPostsSpider</code> 类来说，改动可以更进一步。这次我们可以直接删除其中和文件写入相关的所有代码。让它只负责一件事情：“获取帖子列表”。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">HNTopPostsSpider</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;抓取 HackerNews Top 内容条目

    :param limit: 限制条目数，默认为 5
    &quot;&quot;&quot;</span>
    ITEMS_URL <span class="token operator">=</span> <span class="token string">'https://news.ycombinator.com/'</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> limit<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>limit <span class="token operator">=</span> limit

    <span class="token keyword">def</span> <span class="token function">fetch</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Generator<span class="token punctuation">[</span>Post<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token comment"># &lt;... 已省略 ...&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>相应的，类和函数的调用方 <code>main</code> 函数就需要稍作调整，它需要负责把 <code>write_posts_to_file</code> 函数和 <code>HNTopPostsSpider</code> 类之间协调起来，共同完成工作：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    crawler <span class="token operator">=</span> HNTopPostsSpider<span class="token punctuation">(</span><span class="token punctuation">)</span>

    posts <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>crawler<span class="token punctuation">.</span>fetch<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    file_title <span class="token operator">=</span> <span class="token string">'Top news on HN'</span>
    write_posts_to_file<span class="token punctuation">(</span>posts<span class="token punctuation">,</span> sys<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span> file_title<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>将“文件写入”职责拆分为新函数是一个 Python 特色的解决方案，它虽然没有那么 OO*（面向对象）*，但是同样满足“单一职责原则”，而且在很多场景下更灵活与高效。</p> <h2 id="o-开放-关闭原则"><a href="#o-开放-关闭原则" class="header-anchor">#</a> O：开放-关闭原则</h2> <p>O 来自于 “Open–closed principle（开放-关闭原则）” 的首字母，它认为：<strong>“类应该对扩展开放，对修改封闭。”<strong>这是一个从字面上很难理解的原则，它同样有着另外一种说法：</strong>“你应该可以在不修改某个类的前提下，扩展它的行为。”</strong></p> <p>这原则听上去有点让人犯迷糊，如何能做到不修改代码又改变行为呢？让我来举一个例子：你知道 Python 里的内置排序函数 <code>sorted</code> 吗？</p> <p>如果我们想对某个列表排序，可以直接调用 <code>sorted</code> 函数：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>现在，假如我们想改变 <code>sorted</code> 函数的排序逻辑。比如，让它使用所有元素对 3 取余后的结果来排序。我们是不是需要去修改 <code>sorted</code> 函数的源码？当然不用，只需要在调用 <code>sort</code> 函数时，传入自定义的排序函数 <code>key</code> 参数就行了：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span>
<span class="token comment"># 按照元素对 3 的余数排序，能被 3 整除的 9 排在了最前面，随后是 1 和 8</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> i<span class="token punctuation">:</span> i <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>通过上面的例子，我们可以认为：<code>sorted</code> 函数是一个符合“开放-关闭原则”的绝佳例子，因为它：</p> <ul><li><strong>对扩展开放</strong>：你可以通过传入自定义 <code>key</code> 函数来扩展它的行为</li> <li><strong>对修改关闭</strong>：你无需修改 sort 函数本身</li></ul> <h3 id="如何违反-开放-关闭原则"><a href="#如何违反-开放-关闭原则" class="header-anchor">#</a> 如何违反“开放-关闭原则”</h3> <p>现在，让我们回到爬虫小程序。在使用了一段时间之后，用户*（还是我）*觉得每次抓取到的内容有点不合口味。我其实只关注那些来自特定网站，比如 github 上的内容。所以我需要修改 <code>HNTopPostsSpider</code> 类的代码来对结果进行过滤：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">HNTopPostsSpider</span><span class="token punctuation">:</span>
    <span class="token comment"># &lt;... 已省略 ...&gt;</span>

    <span class="token keyword">def</span> <span class="token function">fetch</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Generator<span class="token punctuation">[</span>Post<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token comment"># &lt;... 已省略 ...&gt;</span>
        counter <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>
            <span class="token keyword">if</span> counter <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>limit<span class="token punctuation">:</span>
                <span class="token keyword">break</span>

            <span class="token comment"># &lt;... 已省略 ...&gt;</span>
            link <span class="token operator">=</span> node_title<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span>

            <span class="token comment"># 只关注来自 github.com 的内容</span>
            <span class="token keyword">if</span> <span class="token string">'github'</span> <span class="token keyword">in</span> link<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                counter <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token keyword">yield</span> Post<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>完成修改后，让我们来简单测试一下效果：</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>❯ python news_digester_O_before.py
# Top news on HN

&gt; TOP 1: Mimalloc – A compact general-purpose allocator
&gt; 分数：291 评论数：40
&gt; 地址：https://github.com/microsoft/mimalloc
------
&gt; TOP 2: Olivia: An open source chatbot build with a neural network in Go
&gt; 分数：53 评论数：19
&gt; 地址：https://github.com/olivia-ai/olivia
------
&amp;lt;... 已省略 ...&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>看上去新加的过滤代码起到了作用，现在只有链接中含有 <code>github</code> 的内容才会被写入到结果中。</p> <p>但是，正如某位哲学家的名言所说：*“这世间唯一不变的，只有变化本身。”<em>某天，用户</em>（永远是我）*突然觉得，来自 <code>bloomberg</code> 的内容也都很有意思，所以我想要把 <code>bloomberg</code> 也加入筛选关键字逻辑里。</p> <p>这时我们就会发现：现在的代码违反了&quot;开放-关闭原则&quot;。因为我必须要修改现有的 <code>HNTopPostsSpider</code> 类代码，调整那个 <code>if 'github' in link.lower()</code> 判断语句才能完成我的需求。</p> <p>“开放-关闭原则”告诉我们，类应该通过扩展而不是修改的方式改变自己的行为。那么我应该如何调整代码，让它可以遵循原则呢？</p> <h3 id="使用类继承来改造代码"><a href="#使用类继承来改造代码" class="header-anchor">#</a> 使用类继承来改造代码</h3> <p>继承是面向对象理论中最重要的概念之一。它允许我们在父类中定义好数据和方法，然后通过继承的方式让子类获得这些内容，并可以选择性的对其中一些进行重写，修改它的行为。</p> <p>使用继承的方式来让类遵守“开放-关闭原则”的关键点在于：<strong>找到父类中会变动的部分，将其抽象成新的方法（或属性），最终允许新的子类来重写它以改变类的行为。</strong></p> <p>对于 <code>HNTopPostsSpider</code> 类来说。首先，我们需要找到其中会变动的那部分逻辑，也就是*“判断是否对条目感兴趣”*，然后将其抽象出来，定义为新的方法：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">HNTopPostsSpider</span><span class="token punctuation">:</span>
    <span class="token comment"># &lt;... 已省略 ...&gt;</span>

    <span class="token keyword">def</span> <span class="token function">fetch</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Generator<span class="token punctuation">[</span>Post<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token comment"># &lt;... 已省略 ...&gt;</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>
            <span class="token comment"># &lt;... 已省略 ...&gt;</span>
            
            post <span class="token operator">=</span> Post<span class="token punctuation">(</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
            <span class="token comment"># 使用测试方法来判断是否返回该帖子</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>interested_in_post<span class="token punctuation">(</span>post<span class="token punctuation">)</span><span class="token punctuation">:</span>
                counter <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token keyword">yield</span> post

    <span class="token keyword">def</span> <span class="token function">interested_in_post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> post<span class="token punctuation">:</span> Post<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;判断是否应该将帖子加入结果中
        &quot;&quot;&quot;</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>如果我们只关心来自 <code>github</code> 的帖子，那么只需要定义一个继承于 <code>HNTopPostsSpider</code> 子类，然后重写父类的 <code>interested_in_post</code> 方法即可。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">GithubOnlyHNTopPostsSpider</span><span class="token punctuation">(</span>HNTopPostsSpider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;只关心来自 Github 的内容
    &quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">interested_in_post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> post<span class="token punctuation">:</span> Post<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'github'</span> <span class="token keyword">in</span> post<span class="token punctuation">.</span>link<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># crawler = HNTopPostsSpider()</span>
    <span class="token comment"># 使用新的子类</span>
    crawler <span class="token operator">=</span> GithubOnlyHNTopPostsSpider<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>假如我们的兴趣发生了变化？没关系，增加新的子类就行：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">GithubNBloomBergHNTopPostsSpider</span><span class="token punctuation">(</span>HNTopPostsSpider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;只关系来自 Github/BloomBerg 的内容
    &quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">interested_in_post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> post<span class="token punctuation">:</span> Post<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token string">'github'</span> <span class="token keyword">in</span> post<span class="token punctuation">.</span>link<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> \
                <span class="token keyword">or</span> <span class="token string">'bloomberg'</span> <span class="token keyword">in</span> post<span class="token punctuation">.</span>link<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>所有的这一切，都不需要修改原本的 <code>HNTopPostsSpider</code> 类的代码，只需要不断在它的基础上创建新的子类就能完成新需求。最终实现了对扩展开放、对改变关闭。</p> <h3 id="使用组合与依赖注入来改造代码"><a href="#使用组合与依赖注入来改造代码" class="header-anchor">#</a> 使用组合与依赖注入来改造代码</h3> <p>虽然类的继承特性很强大，但它并非唯一办法，<a href="https://en.wikipedia.org/wiki/Dependency_injection" target="_blank" rel="noopener noreferrer">依赖注入（Dependency injection）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是解决这个问题的另一种思路。与继承不同，依赖注入允许我们在类实例化时，通过参数将业务逻辑的变化点：<strong>帖子过滤算法</strong> 注入到类实例中。最终同样实现“开放-关闭原则”。</p> <p>首先，我们定义一个名为 <code>PostFilter</code> 的抽象类：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> abc <span class="token keyword">import</span> ABC<span class="token punctuation">,</span> abstractmethod

<span class="token keyword">class</span> <span class="token class-name">PostFilter</span><span class="token punctuation">(</span>metaclass<span class="token operator">=</span>ABCMeta<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;抽象类：定义如何过滤帖子结果
    &quot;&quot;&quot;</span>
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">validate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> post<span class="token punctuation">:</span> Post<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;判断帖子是否应该被保留&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>Hint：定义抽象类在 Python 的 OOP 中并不是必须的，你也可以不定义它，直接从下面的 DefaultPostFilter 开始。</p></blockquote> <p>然后定义一个继承于该抽象类的默认 <code>DefaultPostFilter</code> 类，过滤逻辑为保留所有结果。之后再调整一下 <code>HNTopPostsSpider</code> 类的构造方法，让它接收一个名为 <code>post_filter</code> 的结果过滤器：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">DefaultPostFilter</span><span class="token punctuation">(</span>PostFilter<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;保留所有帖子
    &quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">validate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> post<span class="token punctuation">:</span> Post<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>


<span class="token keyword">class</span> <span class="token class-name">HNTopPostsSpider</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;抓取 HackerNews Top 内容条目

    :param limit: 限制条目数，默认为 5
    :param post_filter: 过滤结果条目的算法，默认为保留所有
    &quot;&quot;&quot;</span>
    ITEMS_URL <span class="token operator">=</span> <span class="token string">'https://news.ycombinator.com/'</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> limit<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> post_filter<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>PostFilter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>limit <span class="token operator">=</span> limit
        self<span class="token punctuation">.</span>post_filter <span class="token operator">=</span> post_filter <span class="token keyword">or</span> DefaultPostFilter<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">fetch</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Generator<span class="token punctuation">[</span>Post<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token comment"># &lt;... 已省略 ...&gt;</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>
            <span class="token comment"># &lt;... 已省略 ...&gt;</span>
            
            post <span class="token operator">=</span> Post<span class="token punctuation">(</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
            
            <span class="token comment"># 使用测试方法来判断是否返回该帖子</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>post_filter<span class="token punctuation">.</span>validate<span class="token punctuation">(</span>post<span class="token punctuation">)</span><span class="token punctuation">:</span>
                counter <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token keyword">yield</span> post
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>默认情况下，<code>HNTopPostsSpider.fetch</code> 会保留所有的结果。假如我们想要定义自己的过滤算法，只要新建自己的 <code>PostFilter</code> 类即可，下面是两个分别过滤 GitHub 与 BloomBerg 的 <code>PostFilter</code> 类：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>class GithubPostFilter(PostFilter):
    def validate(self, post: Post) -&gt; bool:
        return 'github' in post.link.lower()


class GithubNBloomPostFilter(PostFilter):
    def validate(self, post: Post) -&gt; bool:
        if 'github' in post.link.lower() or 'bloomberg' in post.link.lower():
            return True
        return False
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在 <code>main()</code> 函数中，我可以用不同的 <code>post_filter</code> 参数来实例化 <code>HNTopPostsSpider</code> 类，最终满足不同的过滤需求：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># crawler = HNTopPostsSpider()</span>
    <span class="token comment"># crawler = HNTopPostsSpider(post_filter=GithubPostFilter())</span>
    crawler <span class="token operator">=</span> HNTopPostsSpider<span class="token punctuation">(</span>post_filter<span class="token operator">=</span>GithubNBloomPostFilter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    posts <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>crawler<span class="token punctuation">.</span>fetch<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    file_title <span class="token operator">=</span> <span class="token string">'Top news on HN'</span>
    write_posts_to_file<span class="token punctuation">(</span>posts<span class="token punctuation">,</span> sys<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span> file_title<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>与基于继承的方式一样，利用将“过滤算法”抽象为 <code>PostFilter</code> 类并以实例化参数的方式注入到 <code>HNTopPostsSpider</code> 中，我们同样实现了“开放-关闭原则”。</p> <h3 id="使用数据驱动思想来改造代码"><a href="#使用数据驱动思想来改造代码" class="header-anchor">#</a> 使用数据驱动思想来改造代码</h3> <p>在实现“开放-关闭”原则的众多手法中，除了继承与依赖注入外，还有一种经常被用到的方式：<strong>“数据驱动”</strong>。这个方式的核心思想在于：<strong>将经常变动的东西，完全以数据的方式抽离出来。当需求变动时，只改动数据，代码逻辑保持不动。</strong></p> <p>它的原理与“依赖注入”有一些相似，同样是把变化的东西抽离到类外部。不同的是，后者抽离的通常是类，而前者抽离的是数据。</p> <p>为了让 <code>HNTopPostsSpider</code> 类的行为可以被数据驱动，我们需要使其接收 <code>filter_by_link_keywords</code> 参数：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">HNTopPostsSpider</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;抓取 HackerNews Top 内容条目

    :param limit: 限制条目数，默认为 5
    :param filter_by_link_keywords: 过滤结果的关键词列表，默认为 None 不过滤
    &quot;&quot;&quot;</span>
    ITEMS_URL <span class="token operator">=</span> <span class="token string">'https://news.ycombinator.com/'</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>
                 limit<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span>
                 filter_by_link_keywords<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>limit <span class="token operator">=</span> limit
        self<span class="token punctuation">.</span>filter_by_link_keywords <span class="token operator">=</span> filter_by_link_keywords

    <span class="token keyword">def</span> <span class="token function">fetch</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Generator<span class="token punctuation">[</span>Post<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token comment"># &lt;... 已省略 ...&gt;</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>
            <span class="token comment"># &lt;... 已省略 ...&gt;</span>
            
            post <span class="token operator">=</span> Post<span class="token punctuation">(</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>filter_by_link_keywords <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                counter <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token keyword">yield</span> post
            <span class="token comment"># 当 link 中出现任意一个关键词时，返回结果</span>
            <span class="token keyword">elif</span> <span class="token builtin">any</span><span class="token punctuation">(</span>keyword <span class="token keyword">in</span> post<span class="token punctuation">.</span>link <span class="token keyword">for</span> keyword <span class="token keyword">in</span> self<span class="token punctuation">.</span>filter_by_link_keywords<span class="token punctuation">)</span><span class="token punctuation">:</span>
                counter <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token keyword">yield</span> post
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>调整了初始化参数后，还需要在 <code>main</code> 函数中定义 <code>link_keywords</code> 变量并将其传入到 <code>HNTopPostsSpider</code> 类的构造方法中，之后所有针对过滤关键词的调整都只需要修改这个列表即可，无需改动 <code>HNTopPostsSpider</code> 类的代码，同样满足了“开放-关闭原则”。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># link_keywords = None</span>
    link_keywords <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">'github.com'</span><span class="token punctuation">,</span>
        <span class="token string">'bloomberg.com'</span>
    <span class="token punctuation">]</span>
    crawler <span class="token operator">=</span> HNTopPostsSpider<span class="token punctuation">(</span>filter_by_link_keywords<span class="token operator">=</span>link_keywords<span class="token punctuation">)</span>

    posts <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>crawler<span class="token punctuation">.</span>fetch<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    file_title <span class="token operator">=</span> <span class="token string">'Top news on HN'</span>
    write_posts_to_file<span class="token punctuation">(</span>posts<span class="token punctuation">,</span> sys<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span> file_title<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>与前面的继承和依赖注入方式相比，“数据驱动”的代码更简洁，不需要定义额外的类。但它同样也存在缺点：<strong>它的可定制性不如前面的两种方式</strong>。假如，我想要以“链接是否以某个字符串结尾”作为新的过滤条件，那么现在的数据驱动代码就有心无力了。</p> <p>如何选择合适的方式来让代码符合“开放-关闭原则”，需要根据具体的需求和场景来判断。这也是一个无法一蹴而就、需要大量练习和经验积累的过程。</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>在这篇文章中，我通过一个具体的 Python 代码案例，向你描述了 “SOLID” 设计原则中的前两位成员：<strong>“单一职责原则”</strong> 与 <strong>“开放-关闭原则”</strong>。</p> <p>这两个原则虽然看上去很简单，但是它们背后蕴藏了许多从好代码中提炼而来的智慧。它们的适用范围也不仅仅局限在 OOP 中。一旦你深入理解它们后，你可能会惊奇的在许多设计模式和框架中发现它们的影子*（比如这篇文章就出现了至少 3 种设计模式，你知道是哪些吗？）*。</p> <p>让我们最后再总结一下吧：</p> <ul><li><strong>“S: 单一职责原则”</strong> 认为一个类只应该有一种被修改的原因</li> <li>编写更小的类通常更不容易违反 S 原则</li> <li>S 原则同样适用于函数，你可以让函数和类协同工作</li> <li><strong>“O: 开放-关闭原则”</strong> 认为类应该对改动关闭，对扩展开放</li> <li>找到需求中频繁变化的那个点，是让类遵循 O 原则的重点所在</li> <li>使用子类继承的方式可以让类遵守 O 原则</li> <li>通过定义算法类，并进行依赖注入，也可以让类遵循 O 原则</li> <li>将数据与逻辑分离，使用数据驱动的方式也是改造代码的好办法</li></ul> <p>看完文章的你，有没有什么想吐槽的？请留言或者在 <a href="https://github.com/piglei/one-python-craftsman" target="_blank" rel="noopener noreferrer">项目 Github Issues<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 告诉我吧。</p> <p><a href="/docs/python-craftsman/13-write-solid-python-codes-part-2.html">&gt;&gt;&gt;下一篇【13.写好面向对象代码的原则（中）】</a></p> <p><a href="/docs/python-craftsman/11-three-tips-on-writing-file-related-codes.html">&lt;&lt;&lt;上一篇【11.高效操作文件的三个建议】</a></p> <h2 id="附录"><a href="#附录" class="header-anchor">#</a> 附录</h2> <ul><li>题图来源: Photo by Kelly Sikkema on Unsplash</li> <li>更多系列文章地址：https://github.com/piglei/one-python-craftsman</li></ul> <p>系列其他文章：</p> <ul><li><a href="https://github.com/piglei/one-python-craftsman" target="_blank" rel="noopener noreferrer">所有文章索引 [Github]<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.zlovezl.cn/articles/function-returning-tips/" target="_blank" rel="noopener noreferrer">Python 工匠：让函数返回结果的技巧<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.zlovezl.cn/articles/two-tips-on-loop-writing/" target="_blank" rel="noopener noreferrer">Python 工匠：编写地道循环的两个建议<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.zlovezl.cn/articles/three-tips-on-writing-file-related-codes/" target="_blank" rel="noopener noreferrer">Python 工匠：高效操作文件的三个建议<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/docs/python-craftsman/11-three-tips-on-writing-file-related-codes.html" class="prev">
            Python 工匠：高效操作文件的三个建议
          </a></span> <span class="next"><a href="/docs/python-craftsman/13-write-solid-python-codes-part-2.html">
            Python 工匠：写好面向对象代码的原则（中）
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:0;" data-v-106c08ae></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-a008c6ba data-v-a008c6ba><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-a008c6ba><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-a008c6ba></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-a008c6ba></path></svg></div></div></div>
    <script src="/assets/js/app.c4198b61.js" defer></script><script src="/assets/js/4.91381aee.js" defer></script><script src="/assets/js/1.2f47c004.js" defer></script><script src="/assets/js/24.2e774eb3.js" defer></script>
  </body>
</html>
